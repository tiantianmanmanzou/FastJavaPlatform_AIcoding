# 用户管理系统 - 部署与运行指南

## 系统概述

本系统是一个完整的用户权限管理系统，包含以下功能模块：

### 功能特性

1. **用户管理**
   - 用户增删改查
   - 用户状态管理（启用/禁用）
   - 密码重置功能
   - 用户角色分配
   - 批量删除

2. **角色管理**
   - 角色增删改查
   - 角色权限配置
   - 角色状态管理

3. **权限管理**
   - 权限增删改查
   - 树形权限结构
   - 支持菜单、按钮、接口三种权限类型
   - 父子权限关系

4. **登录认证**
   - JWT Token 认证
   - BCrypt 密码加密
   - Token 自动刷新
   - 登录状态管理

5. **默认账号**
   - 用户名：`admin`
   - 密码：`Admin@123`
   - 拥有系统管理员角色，具备所有权限

## 技术栈

### 后端
- Spring Boot 3.2.5
- Spring Security（JWT认证）
- MyBatis Plus 3.5.6
- MySQL 8.0+
- Maven

### 前端
- React 19.1.0
- TypeScript
- Redux Toolkit 2.8.2
- React Router 7.6.3
- Ant Design 5.26.4
- Axios
- Vite 7.0.4

## 环境要求

- **JDK**: 17+
- **Maven**: 3.6+
- **Node.js**: 18+
- **MySQL**: 8.0+

## 数据库设置

### 1. 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS java_backend_template
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;
```

### 2. 创建表结构

执行以下SQL脚本（位于 `1_backend_springboot/src/main/resources/db/schema.sql`）：

```sql
CREATE TABLE IF NOT EXISTS sys_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(64) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(128),
    real_name VARCHAR(128),
    mobile VARCHAR(32),
    department VARCHAR(128),
    status TINYINT DEFAULT 1,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_name VARCHAR(128) NOT NULL,
    role_code VARCHAR(128) NOT NULL UNIQUE,
    description VARCHAR(255),
    status TINYINT DEFAULT 1,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_permission (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    permission_name VARCHAR(128) NOT NULL,
    permission_code VARCHAR(128) NOT NULL UNIQUE,
    type VARCHAR(32) NOT NULL,
    parent_id BIGINT,
    path VARCHAR(255),
    method VARCHAR(20),
    sort INT DEFAULT 0,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_user_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    role_id BIGINT NOT NULL,
    UNIQUE KEY uk_user_role (user_id, role_id)
);

CREATE TABLE IF NOT EXISTS sys_role_permission (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_id BIGINT NOT NULL,
    permission_id BIGINT NOT NULL,
    UNIQUE KEY uk_role_permission (role_id, permission_id)
);
```

### 3. 配置数据库连接

修改 `1_backend_springboot/src/main/resources/application-dev.yml` 中的数据库配置：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/java_backend_template?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    username: root  # 修改为你的数据库用户名
    password: root123  # 修改为你的数据库密码
```

## 后端启动

### 方式一：IDE 启动（推荐）

1. 使用 IntelliJ IDEA 或 Eclipse 打开项目
2. 找到 `1_backend_springboot/src/main/java/com/template/TemplateApplication.java`
3. 右键运行 main 方法

### 方式二：Maven 命令启动

```bash
cd 1_backend_springboot
mvn clean install
mvn spring-boot:run
```

### 验证后端启动

- 后端默认端口：`8080`
- Swagger 文档：http://localhost:8080/swagger-ui.html
- 健康检查：http://localhost:8080/actuator/health

### 自动初始化

后端启动时会自动执行以下操作：
1. 创建默认的系统管理员角色（SYSTEM_ADMIN）
2. 创建默认的权限数据（用户管理、角色管理、权限管理相关权限）
3. 创建默认的 admin 账号（密码已加密）
4. 绑定 admin 账号与系统管理员角色

## 前端启动

### 1. 安装依赖

```bash
cd 0_frontend_react
npm install
```

### 2. 配置环境变量

已创建 `.env.development` 文件，内容如下：

```
VITE_APP_BASE_API=http://localhost:8080/api
```

### 3. 启动开发服务器

```bash
npm run dev
```

前端默认端口：`5173`

访问地址：http://localhost:5173

### 4. 清除 Vite 缓存（如遇问题）

如果遇到模块导入错误，可以清除 Vite 缓存：

```bash
rm -rf node_modules/.vite
npm run dev
```

## 登录系统

1. 打开浏览器访问：http://localhost:5173
2. 使用默认账号登录：
   - 用户名：`admin`
   - 密码：`Admin@123`
3. 登录成功后即可访问用户管理、角色管理、权限管理等功能

## 功能使用说明

### 用户管理


路径：系统管理 → 用户权限管理 → 用户管理

- **新增用户**：点击"新增用户"按钮，填写用户信息并分配角色
- **编辑用户**：点击表格行的"编辑"按钮
- **重置密码**：点击"重置密码"按钮，为用户设置新密码
- **启用/禁用**：点击"启用"或"禁用"按钮切换用户状态
- **删除用户**：单个删除或批量删除
- **搜索筛选**：支持按用户名、邮箱、状态筛选

### 角色管理

路径：系统管理 → 用户权限管理 → 角色管理

- **新增角色**：创建新的角色，设置角色名称、编码、描述
- **编辑角色**：修改角色信息
- **权限配置**：为角色分配权限（树形结构选择）
- **删除角色**：删除不需要的角色

### 权限管理

路径：系统管理 → 用户权限管理 → 权限管理

- **新增权限**：创建菜单、按钮或接口权限
- **编辑权限**：修改权限信息
- **设置父权限**：构建权限树形结构
- **删除权限**：删除不需要的权限

## API 接口文档

访问 Swagger 文档查看完整的 API 接口：http://localhost:8080/swagger-ui.html

主要接口：

### 认证接口
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `POST /api/auth/refresh` - 刷新 Token
- `GET /api/auth/info` - 获取当前用户信息

### 用户接口
- `GET /api/users` - 分页查询用户列表
- `POST /api/users` - 创建用户
- `PUT /api/users/{id}` - 更新用户
- `DELETE /api/users/{id}` - 删除用户
- `PUT /api/users/{id}/password` - 修改用户密码
- `PUT /api/users/{id}/status` - 修改用户状态

### 角色接口
- `GET /api/roles` - 分页查询角色列表
- `GET /api/roles/all` - 查询所有角色
- `GET /api/roles/{id}` - 查询角色详情
- `POST /api/roles` - 创建角色
- `PUT /api/roles/{id}` - 更新角色
- `DELETE /api/roles/{id}` - 删除角色
- `POST /api/roles/{id}/permissions` - 分配角色权限

### 权限接口
- `GET /api/permissions` - 分页查询权限列表
- `GET /api/permissions/tree` - 查询权限树
- `POST /api/permissions` - 创建权限
- `PUT /api/permissions/{id}` - 更新权限
- `DELETE /api/permissions/{id}` - 删除权限

## 常见问题

### 1. react-redux 导入错误

**问题**：`The requested module does not provide an export named 'TypedUseSelectorHook'`

**解决**：
```bash
cd 0_frontend_react
rm -rf node_modules/.vite
npm run dev
```

### 2. 后端无法连接数据库

**问题**：`Could not connect to MySQL`

**解决**：
- 确认 MySQL 服务已启动
- 检查数据库配置（用户名、密码、端口）
- 确认数据库 `java_backend_template` 已创建

### 3. 前端 API 请求失败

**问题**：Network Error 或 CORS 错误

**解决**：
- 确认后端服务已启动（端口 8080）
- 检查 `.env.development` 中的 API 地址配置
- 查看后端 CORS 配置是否包含前端地址

### 4. 登录后 Token 无效

**问题**：401 Unauthorized

**解决**：
- 检查 JWT 密钥配置（application.yml 中的 `jwt.secret`）
- 确认 Token 未过期
- 清除浏览器缓存和 localStorage

## 生产环境部署

### 前端打包

```bash
cd 0_frontend_react
npm run build
```

打包后的文件在 `dist` 目录，可以部署到 Nginx 或其他 Web 服务器。

### 后端打包

```bash
cd 1_backend_springboot
mvn clean package -DskipTests
```

生成的 jar 文件位于 `target` 目录，可以使用以下命令运行：

```bash
java -jar target/java-backend-template-1.0.0.jar --spring.profiles.active=prod
```

## 安全建议

1. **修改默认密码**：首次登录后立即修改 admin 账号密码
2. **更换 JWT 密钥**：修改 `application.yml` 中的 `jwt.secret` 为复杂的随机字符串
3. **数据库密码**：使用强密码，不要使用默认密码
4. **HTTPS**：生产环境建议使用 HTTPS 协议
5. **定期备份**：定期备份数据库数据

## 技术支持

如有问题，请检查：
1. 后端日志输出
2. 浏览器控制台错误信息
3. 数据库连接状态
4. 网络连接情况

---

**祝您使用愉快！** 🎉
